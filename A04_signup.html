<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        .signup-form {
            width: 100%;
            margin-bottom: 2rem;
            margin-top: -2rem;
        }

        .form-group {
            margin-bottom: 1rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #444;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input::placeholder {
            color: #aaa;
            transition: color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #005ea7;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .form-group input:focus::placeholder {
            color: #ccc;
        }

        .login-option {
            text-align: center;
        }

        .login-link {
            color: #005ea7;
            font-weight: 500;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .login-link:hover {
            color: #005ea7;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="Images/jcu-logo.png" alt="JCU Logo" class="jcu-logo">
        <div class="left-section">
            <div class="menu-btn">
                <i class="fas fa-bars menu-icon"></i>
                <span class="menu-text">Menu</span>
            </div>
            <img src="Images/main-chair-image.png" alt="smart seat" class="main-chair-image">
            <div class="center-content">
                <i class="fas fa-fingerprint fingerprint-icon"></i>
                <div class="take-seat">SmartSeat</div>
            </div>
        </div>
        <div class="right-section auth-section">
            <div class="auth-container">
                <form class="signup-form" method="post">
                    <h1 class="auth-title">Sign Up</h1>

                    <div class="form-group">
                        <label for="fullname">Full Name</label>
                        <input type="text" id="fullname" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Create a password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <input type="password" id="confirm-password" placeholder="Confirm your password" required>
                    </div>
                    
                    <button type="submit" class="primary-btn signup-btn">
                        Create Account <i class="fas fa-check ml-2"></i>
                    </button>
                    <div id="signup-status" style="margin-top:8px;font-size:13px;color:#444"></div>
                </form>
                <hr class="divider">
                <div class="login-option">
                    <p>Already have an account? <a href="A01_signin_credentials.html" class="login-btn">Login</a></p>
                </div>
            </div>
        </div>
    </div>
    <script>
    (function(){
        const form = document.querySelector('.signup-form');
        const statusEl = document.getElementById('signup-status');
        const origin = window.location.origin;
        const API_BASE = (location.protocol === 'file:' || origin === 'null' || !origin) ? 'http://127.0.0.1:8000' : origin;
        function setStatus(msg, err){ if(!statusEl)return; statusEl.textContent = msg; statusEl.style.color = err? 'crimson':'#2b7a0b'; }
        form.addEventListener('submit', async function(e){
            e.preventDefault();
            const name = document.getElementById('fullname').value.trim();
            const email = document.getElementById('email').value.trim();
            const pw = document.getElementById('password').value;
            const pw2 = document.getElementById('confirm-password').value;
            if(!name || !email || !pw){ setStatus('请完整填写信息 / Please fill all fields', true); return; }
            if(pw !== pw2){ setStatus('两次密码不一致 / Passwords do not match', true); return; }
            if(pw.length < 6){ setStatus('密码至少 6 位 / Password must be ≥ 6 chars', true); return; }
            setStatus('创建账户中... / Creating account...');
            try {
                // signup
                let res = await fetch(API_BASE + '/api/auth/signup', {
                    method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name, email, password: pw })
                });
                let data = await res.json().catch(()=>({}));
                if(!res.ok){
                    const detail = data.detail || ('Signup failed (HTTP '+res.status+')');
                    setStatus('注册失败: ' + detail, true);
                    return;
                }
                setStatus('账户已创建，自动登录中...');
                // login
                res = await fetch(API_BASE + '/api/auth/login', {
                    method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, password: pw })
                });
                data = await res.json().catch(()=>({}));
                if(!res.ok){
                    setStatus('登录失败: ' + (data.detail || res.statusText), true);
                    return;
                }
                const token = data.token;
                localStorage.setItem('demo_token', token);
                setStatus('注册并登录成功，正在跳转...');
                // Redirect to seat selection page (top-level version)
                window.location.href = 'B03_seat_selection.html';
            } catch(err){
                console.error(err);
                setStatus('网络错误，请确认后端已启动 / Network error: is backend running?', true);
            }
        });
    })();
    </script>
</body>
</html>